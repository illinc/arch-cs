\chapter{Использование массивов}
\setlablabel{array}
\purpose{
ознакомиться с~расположением элементов массива в~памяти компьютера; 
научиться обрабатывать массивы, используя ассемблер.
}

% \section{Варианты заданий}
\begin{tasks}


\item
Cоздайте, используя язык высокого уровня, массив $\alpha[\,]$ из целых чисел.

Изучите расположение элементов массива (используя возможности языка высокого уровня или IDE). %, а~также общий размер массива.
\begin{enumerate}
\item Каков размер элемента (в байтах)?
\item Насколько отличаются адреса соседних элементов массива (в байтах)? 
\item Одинаково или различно это расстояние для разных элементов массива?
\item Каков общий размер массива (в байтах)?
\item Как получить адрес элемента массива, зная его номер и~адрес начала массива?
\end{enumerate}

\item Обработайте массив целых чисел $\alpha[\,]$ (выделение памяти и~заполнение массива может быть выполнено на языке высокого уровня).
\labellocal{task:int:sum}

\begin{variants}[varmain]
Найти минимальный элемент массива
\next
Найти максимальный элемент массива
\next
Найти сумму элементов массива
\end{variants}


\item
\labellocal{task:keyval:debug}
Cоздайте, используя язык высокого уровня, массив  $\beta[\,]$ из структур, содержащих целый ключ и~вещественное значение. % или набор значений.
% \begin{variants}[vardebug]
% Структура содержит ключ и~одно вещественное число.
% \next
% Структура содержит ключ и~комплексное число $(re,im)$.
% \end{variants}

Определите размер массива и~расположение элементов (используя возможности языка высокого уровня или IDE).
\begin{enumerate}
\item Каков размер структуры (в байтах)?
\item Каковы размеры полей структуры (в байтах)?
\item Насколько отличаются адреса соседних полей структуры (в байтах)? 
% \item Одинаково или различно это расстояние для разных полей?
\item Каков общий размер массива (в байтах)?
% \item Как получить адрес элемента массива, зная его номер и~адрес начала массива?
\item Как получить адрес поля элемента массива, зная номер элемента, адрес начала массива и~имя поля?
\end{enumerate}

\item Реализуйте задание~\reflocal{task:int:sum} для значений тех элементов массива~$\beta[\,]$,
ключ которых равен заданному числу~$\kappa$.
Если таких нет, вывести корректное сообщение об этом.

% Поменяйте местами поля структуры. Изменилось ли что-нибудь?

% \item \bonus{+2 балла}  
% создайте две функции, выполняющие одинаковые действия над двумя массивами структур, содержащих целый ключ и~%одно или несколько вещественных значений
% вещественное значение (10-байтного расширенного типа)
% % из раздела \reflocal{task:keyval:debug}
% (например, подсчёт суммы значений для нечётных ключей).
% % 
% Функции должны различаться только типом аргумента-массива, массивы "--- только порядком полей в~структурах-элементах.
% 
% Сравните ассемблерный код и~время выполнения функций.


% \item 
% % \bonus{(+1 балл)}  
% \labellocal{task:align:asm}
% Cоздайте, используя язык высокого уровня, массив структур, содержащих целый ключ и~одно однобайтовое символьное значение. 
% \begin{enumerate}
% \item Каков размер структуры (в байтах)?
% \item Каковы размеры полей структуры (в байтах)?
% \item Насколько отличаются адреса соседних полей структуры (в байтах)? 
% \item Почему поля располагаются в~памяти именно так?
% \item Как получить адрес поля элемента массива, зная номер элемента, адрес начала массива и~имя поля?
% \end{enumerate}


\item 
% \bonus{+2 балла} 
Опишите %ассемблерную 
вставку либо функцию, инициализирующую массив заданной длины $N$ первыми  $N$ элементами последовательности из задания~\ref{lab:jmp:progression} лабораторной работы \ref{lab:jmp}.


\item 
\bonus{+2 балла}  
\labellocal{task:keyval:asm}
Создайте массив структур, содержащих целый ключ и~вещественное значение или набор значений.
Опишите %ассемблерную 
функцию, обрабатывающую этот массив (реализация варианта в~виде вставки, а~не функции, принесёт не более $+1$ балла вместо $+2$).
Адрес и~длина массива должны передаваться в~функцию как параметры.

\begin{variants}[varbonus]
Структура содержит ключ и~одно вещественное число.

Функция получает эталонное значение ключа $E$ и~нормирует соответствующие ключу значения.
После обработки сумма всех значений с~ключом, равным $E$, должна быть равна 1.
\next
Структура содержит ключ и~комплексное число $(re,im)$.

Изменить ключ каждой структуры на номер квадранта, где располагается число (или на 0, если число лежит на одной из осей).
Вернуть количество точек $\RN{I}$ квадранта.
\end{variants}

\end{tasks}

\section{Дополнительные бонусные и~штрафные баллы}

$-2$ балла за \emph{каждое} использование команд \lstinline!loop*!, \lstinline!jcx*! или  \lstinline!jecx*!.
% % http://mar.ugatu.su/assets/files/Arc/lab/asm.pdf
% % На  современных  процессорах  организация  цикла  с  помощью  команд  DEC/ JNZ/JZ предпочтительна с 
% % точки  зрения  производительности;  в  сумме  они  будут  работать  в  два  раза  быстрее,  нежели  одна 
% % инструкция  LOOP.
% 
% Хотя команды  \lstinline!loop*! занимают меньше места, чем комбинация команды \lstinline!dec! с~условным переходом \lstinline!jz/jnz!, но последняя выполняется вдвое быстрее, чем \lstinline!loop*!.
% % 
% Кроме того, организация цикла при помощи явной модификации счётчика и~условных переходов более гибка и,~в~частности, позволяет организовать вложенный цикл.

$-4$ балла за \emph{каждую} утечку памяти (то есть выделенный, но не освобождённый блок динамической памяти).


% $+1$ балл за достаточные комментарии и~хорошее оформление кода


% 
% \section{Адресация}
% 
% Эффективный адрес (32-разрядный) образуется путём суммирования трёх компонентов: базы, индекса и смещения (Base, Index, Displacement), причём возможно умножение индекса на масштаб (Scale):
% $$
% \text{Адрес} = Base + Scale \cdot Index + Displacement
% $$
% где  база и~индекс "--- регистры, $\alpha$ и~$\beta$ "--- числа, $\alpha = 2^{A}$ (и~не более $8$)

\theoryrefs
\theoryref{sec:addressing}
\theoryref{sec:asm-alg}



\section{Вопросы}
\begin{enumerate}
\item Как располагаются в~памяти элементы массива?
\item Как найти размер массива, зная размер элемента и~их количество?
\item Что такое выравнивание полей структуры?
\item Зачем нужно выравнивание данных?

\end{enumerate}



