\chapter{Программирование сопроцессора}
\setlablabel{fpu}

\purpose{познакомиться с~работой сопроцессора и~его командами.}


\begin{tasks}

\item%
\footnote{Использованы материалы: П.\,Закляков. Представление чисел в~памяти ЭВМ. Ошибка «Циклическая дыра».
Системный Администратор, № 10 (119) 2012 г.;
В.\,Яшкардин. IEEE 754 "--- стандарт двоичной арифметики
с~плавающей точкой
}%
Разработайте программу на языке C++, выполняющую вычисления  над вещественными числами одинарной точности (тип float).

Проверьте, что программа действительно работает с~операндами одинарной точности, а~не приводит к~типу float окончательный результат.

% Учтите, что числовой литерал 1 имеет тип int
\begin{variants}[varfloat]
Найти разность $a-b$ для различных значений  $a, b$:
$a=123456789; b=123456788$,

$a=123456788; b=123456787$
\next
Найти значение выражения
$\dfrac{(a+b)^2 - (a^2 + 2ab)}{b^2}$

для различных значений $a, b$ (пример Лавренова):

$a=95; b=1$, 

$a=95; b=0,1$
\next
Не используя умножение, найти суммы

$S_1 = \sum\limits_{i=0}^{N-1} \frac{1}{N}$
~~и~~%
$S_2 = \sum\limits_{i=0}^{2N-1} \frac{1}{N}$

для различных $N$: $10^2, 10^4, 10^6, 10^7, 10^8, 10^9$
\end{variants}

Сравните полученный результат с~теоретическим.
Объясните результат.

Измените тип операндов на double.
Объясните результат.

\item\labellocal{task:inline} 
Составьте программу calc для вычисления выражения с~использованием сопроцессора в~соответствии со своим
вариантом. 

% Вычисление оформите в~виде ассемблерной вставки в~консольном
% приложении на C++. %Основные команды сопроцессора приведены в~Приложении 1.



\item \bonus{+2 балла}
\labellocal{task:func} 
Оформите вычисления из задания~\reflocal{task:inline} как функцию на ассемблере (вещественную от вещественного аргумента~$x$).

\end{tasks}
\section{Дополнительные бонусные и~штрафные баллы}

$-2$ балла за \emph{каждое} использование команды \lstinline!finit!.

Инициализация процессора, в~том числе и~модуля FPU, выполняется операционной системой в~процессе загрузки.


$-2$ балла за потерю точности из-за округления промежуточных расчётов в~заданиях~\reflocal{task:inline} и~\reflocal{task:func}.

$-4$ балла за включение в~отчёт заведомо недостоверных цифр (более 2 недостоверных десятичных знаков в~округлённом результате).

$+1$ балл за поясняющие текущее содержимое стека FPU комментарии.


% \clearpage
\section{Варианты заданий для программы calc\footnote{Использованы: лабораторная работа, подготовленная Л.\,В.\,Илюшечкиной
}  }
\begingroup

\renewcommand\varlocalcountername{\lablabel:var}
\newcounter{\varlocalcountername}
\setcounter{\varlocalcountername}{0}

% \small
\renewcommand\arraystretch{1.4}
% \setlength\extrarulesep{1ex}
% \extrarowheight=2em
\renewcommand{\tabularxcolumn}[1]{m{#1}} 

\noindent\begin{longtabu} to \textwidth {|l<{\refstepcounter{\varlocalcountername}\arabic{\varlocalcountername}}|L|L|L|}
\hline
\multicolumn{1}{|c|}{\thead{{ПК}}}&\thead{МП-30}&\thead{МП-34}&\thead{МП-35}\\\hline
&$\dfrac{1.2+x}{x^2}$ &                    $1.5x^2-3x-1$&                           $\dfrac{\sin(x-1)}{2x}$\\\hline
&$\dfrac{\cos(x)}{\sin(x)+2}$&               $\dfrac{\sin(1.9x)}{x-1.5}$&                    $\sin(x)\cdot\cos(0.9x)$\\\hline
&$\sin(2x)+\cos(3x)$&                 $\sqrt{0.99x} + x^2$&                          $\sin(0.27x)-\cos(x)$\\\hline
&$\ln2\cdot (\sin(1.2x))$&                $\sqrt{3.45x^2+0.1}$&                        $\dfrac{\cos(x)}{\sin(x)+2}$\\\hline
&$1.5+3.88(x^2 -1)$&                 $\cos^3(x)+\tg(x)$&                        $\sin(0.9x)+\cos(x)$\\\hline
&$\dfrac{\cos(x)}{\sin(2x)+1.5}$&            $\sin^2(\frac{x}{2} + 1)$&                        $x(x^2+3x-5)$\\\hline
&$\cos(x+0.9x^2)$&                    $3.4x^2 + 1.5$&                          $\sin(1.5x)+\frac{1}{x}$\\\hline
&$\cos(x-0.8)+ x$&                   $(\frac{x}{2} + 1.5)(x+1)$&                     $\sin((\cos(x)+1.3))$\\\hline
&$\sqrt{\sin(2x) + x}$&                    $\dfrac{x^2+4}{\sin(2x)}$&                       $\sqrt{\dfrac{x-1.2}{2x}}$\\\hline
&$2x^2 +x-5$&                        $\sqrt{|x-\ln2|}$&                             $\dfrac{x \tg(x)}{2}$\\\hline
&$(x+1)(2x-1)$&                     $3x^2+2x-1$&                             $|3x^3-2.5|$\\\hline
&$\sin(2x)\cdot\cos(x)$&                  $(2x+0.5)(3x-2)$&                       $\dfrac{7+x}{2x+1}$\\\hline
&$\sin(2.27x)-\cos(x)$&               $\sin(1.88x+1)\cdot\cos(x)$&                   $\cos(x+ \ln2 )$\\\hline
&$\dfrac{\cos(x)}{\sin(2x+1)}$&                $\sqrt{x^3-5} +x$&                          $\cos(x-0.8)+ x^2$\\\hline
&$\sin(0.99x)+\cos(x)$&               $\dfrac{\sin^2(x)}{1+\tg(x)}$&                    $1.1x+0.5x^2$\\\hline
&$\sin(2.5x)-\cos(x^2)$&               $\cos^2(x)+\tg(1.5x)$&                     $\cos(x)\cdot(1+3x^2 )$\\\hline
&$\sin(1.5x)+\cos(x)$&                $2\sqrt{x+1}$&                              $\dfrac{\sin(1.5x)}{\cos(1.5x)}$\\\hline
&$\sin((\cos(x)+1.3))$&               $\dfrac{\sin(x)+1}{2}$&                         $1+2x-3x^2$\\\hline
&$\sin(t+1), %\text{где}~ 
x=2.123t$&               $(x+3)^2 -\sin^2(x)$&                      $|\tg(\frac{x}{2})+1|$\\\hline
&$\cos(x)+\sin(2x)$&                  $\cos(2.1x)-\sin(x)$&                     $\dfrac{\sin(0.5x)}{x^2}$\\\hline
&$0.9x^2 +0.7$&                      $\dfrac{\sin^2(x)}{1+\tg^3(x)}$&                   $\cos^2(x) + \tg(2x)$\\\hline
&$0.5\sin(0.5x+2)$&                  $\dfrac{x}{3x^2-x+1}$&                          $x^2-x+8.7$\\\hline
&$\dfrac{\sin(x)}{\cos(x)+1.1}$&             $x^2(2-3x)$&                             $\dfrac{1}{2.5+x^2}$\\\hline
&$\cos((0.7+x)x)$&                   $|\cos(2x+0.9)|$&                        $\sin(x)\cdot(2.5x^2+3)$\\\hline
&$|\cos(2+x^2)|$&                     $\cos(x-0.8)+ x^2$&                       $\sin(x)+2\cos(x)$\\\hline
&$|1.5x| + x^2$&                     $1.1x+0.5x^2$&                           $\sin(\frac{x}{2.1})-\cos(2x)$\\\hline

\end{longtabu}
\endgroup


\section{Вопросы}


\begin{enumerate}

\item Какие регистры используются в~сопроцессоре для хранения операндов?

\item Какие команды используются для выполнения арифметических операций над вещественными числами?

\item Какие команды используются для выполнения тригонометрических операций?
\item Какие команды используются для сравнения вещественных чисел?
\item Какие флаги регистра \Reg{eflags} содержат результат сравнения вещественных чисел?

\end{enumerate}


\section{Справочные материалы}

% \subsection{Статьи}
\begingroup
\lstset{keywordstyle=}


\begin{enumerate}

\item Список основных команд архитектур x86 и x86-64 "---
\lstinline!Команды архитектур x86 и x86-64.htm!


\end{enumerate}
\endgroup
