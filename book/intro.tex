
\chapter{Понятие вычислительной системы (ВС)}
\epigraph{\begin{stanza}
<<Вот где водится Снарк!>> "--- возгласил Балабон\\
Указав на вершину горы;\\
И~матросов на берег вытаскивал он,\\
Их подтягивал за вихры.\end{stanza}}
{\Snark}

\section{Терминология}
\epigraph{\begin{stanza}Так внемлите, друзья! Вам поведаю я\\Пять бесспорных и~точных примет,\\
По которым поймёте "--- если только найдёте, "---\\Кто попался вам "--- Снарк или нет.\end{stanza}}
{\Snark}
\addquestion{Что включает архитектура системы?}
\addquestion{Что такое вычислительная система?}

% Базовы
 
% http://infosys2006.narod.ru/struct/architec.htm
\termin{Архитектура системы}  в~стандарте ANSI/IEEE Std 1471-2000 (IEEE Recommended Practice for Architectural Description of Software-Intensive Systems) 
определяется как 
фундаментальная организация системы, реализованная в~её~компонентах, их~взаимоотношениях друг с~другом и~средой \\и~принципах, определяющих её~конструкцию (проектирование, дизайн) и~развитие~\cite{infosys2006.narod.ru}. 


\termin{Вычислительная система} (ВС), согласно Воройскому~\cite{voroiskij}, определяется двояко:
\begin{enumerate}
\item Совокупность ЭВМ и~средств программного обеспечения, предназначенная для выполнения вычислительных процессов.

\item Любая автоматизированная система, основанная на использовании ЭВМ.
\end{enumerate}


Термин {автоматизированная система} (АС), %[automated system]
в~свою очередь,~\cite{infosys2006.narod.ru} также  определяет двумя способами:
% в~словаре

\begin{enumerate}
\item    Совокупность управляемого объекта и~автоматических управляющих устройств, в~которых часть функций управления выполняет человек-оператор.

\item    Комплекс технических, программных, др. средств и~персонала, предназначенный для автоматизации различных процессов. \\В отличие от автоматической системы не может функционировать без~участия человека.
\end{enumerate}

% \textterminblue{
% Информатика. Новый систематизированный толковый словарь.    
% \\
% Воройский Ф.\,С.
% }
Если же обратиться к~комплексу стандартов на автоматизированные системы~\cite{ksas-def}, %(КСАС),
% то, согласно ГОСТ 34.003-90 (Комплекс стандартов на автоматизированные системы. Автоматизированные системы. Термины и~определения),
получим третье определение:
% Документация на \termin{автоматизированные системы (АС).}
% 
% Согласно ГОСТ 34.003-90 Комплекс стандартов на автоматизированные системы. Автоматизированные системы. Термины и~определения,
% \termin{Автоматизированная система (АС)}
% \termin{АС}
{автоматизированная система}
 "--- система, состоящая из персонала и~комплекса средств автоматизации его деятельности, реализующая информационную технологию выполнения установленных функций.
%  \textterminblue{ГОСТ 34.003-90}
 
% АС  \termin{не является ПО} в~чистом виде.

Таким образом, вычислительная система глобально может быть представлена как совокупность человека (оператора или программиста), технических средств (вычислительной машины, или компьютера% "--- computer, вычислитель
)
и~связывающих их программных средств.

Соответственно, архитектура вычислительной системы может быть описана двояко:
\begin{itemize}
\item \termin{структурная декомпозиция} позволяет выделить компоненты 
% вычислительной системы, %(её программной и~аппаратной частей, а~также человека)
% и~описать их взаимодействие;
% в~том числе аппаратную составляющую "--- вычислительную машину, или компьютер, программную составляющую и~взаимодействующего с~ними человека;
вычислительной машины, в~том числе компоненты, предназначенные для хранения и~обработки программ
и~компоненты, взаимодействующие с~пользователем;
\item \termin{иерархическая декомпозиция} описывает %взаимодействие вычислительной машины (компьютера) с~программным обеспечением и~с~человеком.
языки  взаимодействия программиста с~программ%ами и, опосредованно
ными и~техническими средствами системы. %, а~также .
\end{itemize}

\section{Структурная декомпозиция вычислительной системы}
\epigraph{\begin{stanza}[0mm]
Кура \\
дура \\
процедура \\
\hspace{\stanzaoddindent}состоит из трёх частей: \\
карбюратор \\
вентилятор \\
\hspace{\stanzaoddindent}и~коробка скоростей!\\
\end{stanza}}{Надпись на парте}

Структурная декомпозиция применяется к~аппаратной части вычислительной системы "--- вычислительной машине, или компьютеру.

Если посмотреть на персональный компьютер, то он, как правило, состоит из \termin{системного блока} и~\termin{внешних устройств,} среди которых обязательно присутствуют \termin{устройства ввода-вывода,} предназначенные для взаимодействия с~пользователем "--- экран, клавиатура, мышь и~т.\,д.
(рис.~\ref{ris:arch-comp-struct}).

% % При более внимательном рассмотрении
% Системный блок, в~свою очередь, состоит из корпуса и~\termin{внутренних устройств.} %, внутри которого располагаются
Внутри системного блока находятся \termin{внутренние устройства:}
\begin{itemize}
\item системная, или материнская плата;
\item центральный процессор;
\item оперативная память (оперативное запоминающее устройство, ОЗУ);
\item внешняя, или долговременная память (жёсткие диски, SSD и~т.\,д.);
\item видеокарта;
\item звуковая карта и~т.\,д.
\end{itemize}
Внутренние устройства защищены корпусом системного блока и~получают постоянный ток через блок питания.
% Некоторые из них, хотя конструктивно выполнены внутри корпуса, не обязательны для работы компьютера.


\begin{illustration}
\includegraphics[width=\wideImageWidth]{arch-comp-struct}

\caption{Устройство компьютера}
\label{ris:arch-comp-struct}
\end{illustration}


% Основным компонентом 
Все компоненты компьютера связывает воедино системная плата (рис.~\ref{ris:motherboard_diagram}).
\index{Структурная декомпозиция!системная плата}

\begin{illustration}
\includegraphics[width=\approvedImageWidth,valign=c]{Motherboard_diagram_ru}

\caption{Схема системной платы}
\label{ris:motherboard_diagram}
\end{illustration}



\termin{Северный мост} "--- обмен между процессором и~скоростными устройствами,
частота шины, вид и~объём ОЗУ, тип шины видеоадаптера.
\begin{itemize}
\item память;
\item шина PCI Express или AGP. 
\end{itemize}

% Процессор связан с~

\termin{Южный мост} "--- часы, память CMOS,
работа с~низкоскоростными интерфейсами:
\begin{itemize} 
\item SATA, 
\item IDE, 
\item контроллер прерываний, 
\item USB, 
\item контроллер прямого доступа.
\end{itemize}

Взаимосвязь различных элементов системной платы и~устройств обеспечивают различные системные шины (магистрали).
Иногда \termin{системной шиной} называют только шину, связывающую процессор и~северный мост.

Совокупность проводов системной магистрали можно разбить на четыре группы (рис.~\ref{ris:bus-controllers}):
\begin{illustration}

% \resizebox{0.8\linewidth}{!}{
% \resizebox{\approvedImageWidth}{!}{
\resizebox{\wideImageWidth}{!}{
\schemafont
\input{book/fragments/arch-bus-controllers}
}
\caption{Структура системной шины}
\label{ris:bus-controllers}
\end{illustration}
\begin{itemize} 
\item шина питания (так как по этой шине не передаётся никакой информации, её часто опускают на схемах);
\item шина управления, используемая для организации обмена самой магистрали;
\item шина данных;
\item шина адреса.
\end{itemize}
\index{Структурная декомпозиция!тактовый генератор}
Шины питания и~управления связывают все устройства, %; шины данных и~адреса охватывают только устройства, связанные с~обработкой данных.
в~том числе \termin{тактовый генератор,}
предназначенный для синхронизации работы различных устройств системной платы.
Тактовый генератор задаёт частоту работы процессора как самого быстрого устройства; частоты  более медленных устройств являются делителями частоты процессора.

\index{Структурная декомпозиция!ПЗУ}
В~\termin{постоянном запоминающем устройстве} (энергонезависимой памяти) хранится микропрограмма управления вычислительной машиной.
Она обязательно включает программы начальной загрузки и~самотестирования.

\index{Структурная декомпозиция!BIOS}
В~постоянном запоминающем устройстве персонального компьютера записывается BIOS (Basic­ Input/Output­ System "--- базовая­ система­ ввода/вывода),
включающая, кроме загрузчика, также настройки и~функции ввода/вывода с~помощью программных прерываний.
Ввод-вывод при помощи BIOS доступен только в~реальном режиме работы компьютера.
Современные операционные системы сразу после загрузки переводят компьютер в~защищённый режим и~не используют BIOS.

Сама операционная система, как и~загружаемые ей программы, располагается в~\termin{оперативной} (энергозависимой) памяти.

\termin{Центральный процессор} (центральное процессорное устройство, ЦПУ) включает
\index{Структурная декомпозиция!процессор}
\index{Структурная декомпозиция!АЛУ}
\index{Структурная декомпозиция!УУ}
\index{Структурная декомпозиция!регистры}
\begin{itemize}
\item арифметико-логическое устройство (АЛУ), выполняющее обработку данных;
\item управляющее устройство (УУ), декодирующее поступающие в~процессор команды и~формирующее на их основе сигналы для АЛУ;
\item регистры "--- сверхбыструю память особой структуры и~малого объёма, предназначенную
% , предназначенные 
для временного хранения данных.
% (в~частности, %специальные регистры хранят сл
% регистр команд содержит декодируемую в~данный момент команду,
% указатель команды содержит адрес следующей команды
% и~т.\,п.;
% % другие специальные
% регистры общего назначения могут быть использованы программистом по своему усмотрению).
Часть регистров может быть использована программистом по своему усмотрению (регистры общего назначения), часть используется для специальных целей.
\end{itemize}
\index{Структурная декомпозиция!кеш-память}
Также современные процессоры содержат кеш-память (сверхоперативную память), предназначенную для прозрачного временного хранения фрагментов оперативной памяти.
Время обращения к~кеш-памяти больше, чем к~регистрам, но меньше, чем к~ОЗУ.
% Кеш-память быстрее ОЗУ, но медленнее регистров


\subsection{Цикл выполнения команды}
\epigraph{\begin{limerick}
    Жил один старичок в Мэриленде \\
    Пивший соевый соус и бренди;\\
    Он их пил понемножку\\
    За ложкою ложку\\
    При свете луны в Мэриленде.\\
\end{limerick}
}
{\Lear}

Выполнение команды начинается с~её загрузки (выборки) из памяти.
Адрес загружаемой команды хранится в~специальном регистре "--- указателе команды (instruction pointer, $ip$).

На рис.~\ref{ris:command-cycle} указатель команд хранит адрес команды К-1.

\begin{illustration}
\resizebox{\wideImageWidth}{!}{
\schemafont
\input{book/fragments/command-cycle}
}

\caption{Цикл выполнения команды}
\label{ris:command-cycle}
\end{illustration}

Двоичный код выбранной команды К-1  попадает в~другой специальный регистр "--- регистр команд.

После выборки команда декодируется, в~частности
\begin{itemize}
\item выбрана ли команда целиком или  необходима дозагрузка (разные команды могут иметь различную длину);
\end{itemize}

После этого в~указатель команд помещается адрес следующей команды.
Чаще всего это команда, непосредственно следующая за выполненной (К-2), но, если К-1 была командой условного или безусловного перехода, вызова или возврата из функции и~т.\,п., адрес следующей команды можно узнать только после выполнения К-1.

\termin{Конвейер:}
\begin{itemize}
\item выборка и~декодирование инструкции
\item    загрузка данных
\item    выполнение инструкции
\item   запись результатов
\end{itemize}




\subsection{Расположение программ и~данных}
\epigraph{\begin{limerick}
    Старичок, проживавший в Рангуне,\\
    Погулять как-то вышел в июне.\\
    Возвращаясь назад,\\
    Нёс он двух поросят,\\
    Арестованных лично в Рангуне.\\
\end{limerick}
}
{\Lear}

Данные и~команды поступают в~процессор по системной шине из памяти.
% Системная шина, кроме всего прочего, реализует связь процессора с~памятью, хранящей программы и~данные.
% Эта связь может быть реализована двояко.
Соответственно, память может быть общей для команд и~данных "--- в~этом случае для связи с~процессором достаточно одной общей шины (рис.~\ref{ris:harvard-prinston}, а).
Такая архитектура требует меньшего количества элементов и~дорожек, поэтому она дешевле и~компактнее.

\begin{illustration}

\newcommand{\DoublearrowYRight}[2]
{
  \path[blockarrow] (#2) ++(0,0.5ex) coordinate(tmpUp) -- (tmpUp-|#1);
  \path[blockarrow] (#2-|#1)   ++(0,-0.5ex) coordinate(tmpDown) -- (tmpDown-|#2) ;
}

\resizebox{0.8\linewidth}{!}{
\schemafont
\begin{tikzpicture}[
node distance=2ex and 4ex,
baseline=(current bounding box.north)
]
\tikzstyle{strokednode}	= [text badly centered, draw=black, thick, minimum height=4ex]
\tikzstyle{block}	= [strokednode, text width=16ex]
\tikzstyle{blockarrow}	= [-latex', draw]
\tikzstyle{hiblock}	= [block, minimum height=8ex]

\coordinate (Pr);
% \UuAluBlock{Pr}

\coordinate[right = 40ex of Pr] (Gv);
% \UuAluBlock{Gv}

% \foreach \i/\s in {Pr/Фон-неймановская (принстонская) архитектура, Gv/Гарвардская архитектура}
\foreach \i/\s in {Pr/а), Gv/б)}
{
  \node[block] ({\i}Output)  at (\i) {Вывод};
  \node[hiblock, above = of {\i}Output] ({\i}Alu) {АЛУ};
  \node[block, above = of {\i}Alu] ({\i}Input) {Ввод};

  \node[strokednode, left = of {\i}Input, rotate=90, anchor=south, inner xsep=1.5ex] ({\i}Uu) {Управляющее устройство};
  
  \path[blockarrow] ({\i}Input) -- ({\i}Alu);
  \path[blockarrow] ({\i}Alu) -- ({\i}Output);
  
  \DoublearrowYRight{{\i}Uu.south}{{\i}Alu.west}
  
  \node[text width=40ex, text badly centered, below = of {\i}Output)] {\s};
}
  \node[hiblock, above = of {Pr}Input] (PrMemory) {Общая память};
  \DoublearrowYRight{{Pr}Uu.south}{PrMemory.west}
  \path[blockarrow] (PrMemory) -- ({Pr}Input);
  \path[blockarrow] ({Pr}Output.east) -- ++(4ex,0) |- (PrMemory);
  
\tikzstyle{narrowblock}	= [strokednode, text width=8ex]
%   \node[narrowblock, above = of {Gv}Input.north east] (GvDataMemory) {Память данных};
% %   \node[narrowblock, above = of {Gv}Input.north west|-GvDataMemory.north] (GvProgMemory) {Память команд};
%   \node[narrowblock, above = of {Gv}Input.north west|-GvDataMemory.north, anchor=west] (GvProgMemory) {Память команд};

  \coordinate[right= 5.5ex of {Gv}Input.north] (GvInputFromData);
  \coordinate[left= 5.5ex of {Gv}Input.north] (GvInputFromProg);
  \node[narrowblock, above = of GvInputFromData] (GvDataMemory) {Память данных};
  \node[narrowblock, above = of GvInputFromProg|-GvDataMemory] (GvProgMemory) {Память команд};

  \DoublearrowYRight{{Gv}Uu.south}{GvProgMemory.west}
  \DoublearrowYRight{{Gv}Uu.south}{GvDataMemory.west}
  \path[blockarrow] (GvProgMemory) -- (GvInputFromProg);
  \path[blockarrow] (GvDataMemory) -- (GvInputFromData);
  \path[blockarrow] ({Gv}Output.east) -- ++(4ex,0) |- (GvDataMemory);

\end{tikzpicture}
}
\caption{Расположение программ и~данных 
в~фон-неймановской~(а) и~гарвардской~(б) архитектурах
% в~принстонской~(а) и~гарвардской~(б) архитектурах
% в~архитектуре с~общей (а) и~раздельными (б) шинами (???)
}
\label{ris:harvard-prinston}
\end{illustration}


\index{Архитектура!фон-неймановская (принстонская)}
Идея общей памяти и~общей шины для программ и~данных использовалась в~проекте Бэббиджа и~впервые была реализована Конрадом Цузе в~Германии.
В~США подобная архитектура разрабатывалась %в~Принстонском университете 
в~школе Мура при Пенсильванском университете
научным коллективом, куда входили, в~частности, Джон Мокли и~Джон Преспер Экерт.
% Незадолго до окончания работ её описание было опубликовано одним из консультантов проекта, Джоном фон Нейманом, без указания соавторов~\cite{Neumann:1945:FDR:1102046}.
Незадолго до окончания работ результаты были описаны одним из участников проекта, Джоном фон Нейманом, без указания соавторов, 
а~затем и~опубликованы в~таком виде куратором со стороны армии, Германом Голдштейном~\cite{Neumann:1945:FDR:1102046}.
Так как  фон Нейман к~тому времени уже был известным математиком,
архитектуру с~общей шиной обычно называют фон-неймановской (или принстонской, по основному месту работы фон Неймана).

\index{Архитектура!гарвардская}
Общая шина для памяти программ и~данных "--- узкое место 
%архитектуры фон Неймана.
% принстонской архитектуры.
фон-неймановской архитектуры.
Ускорить обмен с~памятью можно, введя раздельные шины и,~соответственно,
физически раздельные запоминающие устройства для программ и~для данных (рис.~\ref{ris:harvard-prinston}, б).
Это дороже и~сложнее в~реализации, 
поэтому, хотя проект архитектуры с~раздельными шинами разрабатывался в~Гарвардском университете США одновременно с~проектом школы Мура,
% (соответственно, архитектура с~раздельными шинами программ и~данных называется гарвардской),
использоваться на практике он стал относительно недавно.
Архитектура с~раздельными шинами программ и~данных обычно называется гарвардской.

% В~персональных компьютерах используются процессоры линейки x86 с~фон-неймановской архитектурой. материнская плата и память тоже!
В~персональных компьютерах используется фон-неймановская архитектура.
В~первых процессорах линейки x86 и~соответствующих системных платах такое решение было использовано для удешевления,
в~последующих  из соображений совместимости
также используется единое пространство памяти.
При этом современные процессоры имеют раздельную кеш-память для программ и~данных.
% третья "--- для трансляции адресов
\index{Структурная декомпозиция!кеш-память}

\subsection{Разделы памяти}

\begin{tabularx}{1\linewidth}{@{}LL@{}}
% \setlength{\parskip}{2ex}

\termin{.text} 

Код выполняемой программы
\bigskip

\termin{.data} 

Глобальные переменные программы
\bigskip

\termin{.bss}

Неинициализированные глобальные переменные
\bigskip
% .noinit 	Данные переменных программы 

Куча
(динамическая память)
\bigskip

Стек 
% Локальные переменные подпрограмм

&
Распределение памяти GNU/Linux

\includegraphics[width=\linewidth,keepaspectratio,valign=t]{linuxmem}\centering

\end{tabularx}

\subsubsection{Стек}

\resizebox{1\linewidth}{!}{
\input{book/fragments/stack}
}


\subsection{Регистры x86}



Чем более объёмно запоминающее устройство, тем, как правило, медленнее оно работает.

Оперативная память обладает меньшей скоростью, чем процессор.
Хотя частоты работы как оперативной памяти, так и~процессора непрерывно растут, это соотношение сохраняется.

Соответственно, использование только данных, расположенных в памяти, сильно замедлило бы работу.

Частично обмен данными ускоряется при помощи кеширования.

Без задержек данные можно считать или сохранить из регистров.


 

\includegraphics[width=0.5\linewidth,keepaspectratio,valign=t]{Registers}

\begin{itemize}
\item {Регистры общего назначения} 
 \begin{itemize}
\item   \Reg{a, b, c, d;}  
\item    \Reg{si, di, bp;}
\item   {указатель стека} \Reg{sp}.
 \end{itemize}    
   
\item Сегментные %регистры 
  \Reg{cs, ds, ss, es, fs, gs.}

\item  Регистры состояния и~управления:
\begin{itemize}
\item   регистр флагов \Reg{eflags/flags};

\item       указатель команды \Reg{eip/ip}.
\end{itemize}   

\item   Регистры сопроцессора x87 \Reg{st(0)...st(7)}/расширения MMX \rlap{\Reg{mm0...mm7}}

\item        Регистры расширения XMM \rlap{(128-разрядные \Reg{xmm0...xmm7})}
\end{itemize}

% Также в~состав 

Регистры, специфичные для модели~\cite{intelModelSpecificRegisters}.




\section{Иерархическая декомпозиция ВС}
% \epigraph{\begin{stanza}[0mm]
% Вот опять линяет краска,\\
% И~опять спадает маска,\\
% А~под ней "--- ещё одна,\\
% А~под ней "--- ещё одна,\\
% А~потом "--- ещё, ещё, ещё, ещё, ещё...\\
% \end{stanza}}{Юлий Ким}

\epigraph{
Вертикальная структура мирового древа складывалась из трёх частей, или уровней: нижнего (корни), среднего (ствол) и~верхнего (ветви)%.
...\\ 
% Так сформировались в~воображении древних основные космические зоны, а~с~ними и~сдвоенные противоположности: Земля "--- Небо, Земля "--- Преисподняя, огонь (сухое) "--- влага (мокрое), прошлое "--- настоящее, настоящее "--- будущее, день "--- ночь. Эти пары перемещались в~структуре древа с~троичными единствами: прошлое "--- настоящее "--- будущее; предки "--- современники "--- потомки; три части тела: голова "--- туловище "--- ноги; три стихии: огонь "--- вода "--- земля. Пары и~тройки обнимали самые разнообразные формы жизни. 
Люди постигали взаимосвязь противоположностей, суть всякого развития.
}{Г.\,Белякова}

% В~соответствии 

Согласно Таненбауму~\cite{tanenbaum-arch}, вычислительную систему можно представить в~виде ряда уровней абстракции.

\includegraphics[width=\approvedImageWidth,valign=t]{multi-level-abstract}



\includegraphics[width=\approvedImageWidth,valign=c]{multi-level-asm}


\includegraphics[width=\approvedImageWidth,valign=c]{Layered_computer_structure}

% кратко! Дальше часть того же самого подробнее

\subsection{Цифровой логический уровень}

\epigraph{
 К~каждой из трёх частей древа относились определенные существа. Вверху, на ветвях изображали птиц, посередине, у~ствола "--- копытных (оленей, лосей, коров, лошадей), иногда человека и~пчёл, а~у~корней "--- змей, лягушек, рыб и~бобров. 
%  Бог восседал на самой верхушке древа. Иногда он вступал в~битву со змеем или драконом и~освобождал похищенный ими скот. Древо, символизировавшее зачатие и~плодородие, изображали на женских одеждах.
 }{Г.\,Белякова}



сигналы и~вентили, 0 и~1, триггер как элементарная ячейка памяти, полусумматор, однобитовый сумматор


Сигналы и~вентили

\newcolumntype{Y}{>{$}C<{$}}
\newcolumntype{Z}{>{\columncolor{csMarker}}Y}
\begin{tabularx}{1\linewidth}{YY|YZZ|YYY}
a 	&	b &	\lnot a 	&	\overline{a \land b} 	&	\overline{a \lor b} & a \land b 	&	a \lor b & a \oplus b\\\hline
0 	&	0 	&\multirow{2}{*}{$1$}&	1         	&	1         &0         	&	0         &	0\\
0 	&	1 	&		&	1         	&	0         &0         	&	1         &	1\\\hline
1 	&	0 	&\multirow{2}{*}{$0$}&	1         	&	0         &0         	&	1         &	1\\
1 	&	1 	&		&	0         	&	0         &1         	&	1         &	0\\\hline
\end{tabularx}

\termin{Бит} "--- двоичный разряд (одно состояние).%\raggedright

% \tikz\node [and gate] {};

\includegraphics[width=0.8\linewidth,valign=t]{Logic-gate-index}



\subsection{Микроархитектурный уровень}

\epigraph{\begin{limerick}
Говорят, в~самом сердце Тибета\\
в~страшной тайне содержится
Это.\\
Но есть мнение, что\\
Это "--- вовсе не То;\\
ничего даже общего где-то.\\
\end{limerick}
}
{С.\,Сатин}

\addquestion{Какие вы знаете единицы измерения информации?}
регистр, байт, октет, слово



% Микроархитектура МП – это 
\begin{itemize}
\item аппаратная организация и~логическая структура МП;
\item регистры;
\item управляющие схемы; % (УУ), 
\item арифметико-логические устройства (АЛУ); 
\item запоминающие устройства; 
\item %и~
связывающие их информационные магистрали \rlap{(шины).}
\end{itemize}

% % Шины и~элементы (регистры,  арифметико-логические устройства (АЛУ) и~т.\,д.)
% % \medskip
% % 
% % \termin{Конвейер:}
% % \setlistspacing{1}{0ex}
% % \begin{itemize}
% % \item 
% %     чтение и~декодирование инструкции
% %     
% % \item    загрузка данных
% %     
% % \item    выполнение инструкции
% %     
% %  \item   запись результатов
% % \end{itemize}
% % \medskip
% % 
% % \termin{Тракт данных:}
% % \begin{itemize}
% % \item локальная память
% % % \rlap
% % {(набор регистров);}
% % 
% % \item АЛУ.
% % % арифметико-логическое устройство (АЛУ).
% % \end{itemize}


% \end{tabularx}

\termin{Машинное слово}  "--- разрядность шины данных/регистра.

\termin{Байт} "--- %совокупность битов, обрабатываемая компьютером одномоментно (обычно байт=октет).
минимальный независимо адресуемый \rlap{набор данных.}

\termin{Октет} "--- 8 бит ($2^8 = 256$ состояний).


% Машинное \termin{слово}  "--- разрядность регистров процессора и/или шины данных.



\subsection{Уровень архитектуры команд}
\epigraph{
\begin{stanza}
Ведь очень скоро у~меня будет Это \\
и~я~буду ясно знать, что с~Этим делать.\\
\end{stanza}
}{\Aquarium}

память, адресация, указатель, команды

\newcommand{\grayemph}[1]{\textcolor{gray}{\emph{#1}}} 

\begin{itemize}
\item    архитектура памяти;
\item    взаимодействие с~внешними устройствами ввода/вывода;
\item    режимы адресации;
\item    регистры;
\item    машинные команды
\begin{itemize}
\item    CISC \grayemph{(complex instruction set computer);}
\item    RISC \grayemph{(reduced instruction set computer, %архитектуры 
load/store);}
\item    VLIW \grayemph{(very long instruction word),} суперскалярные;
\end{itemize}
\item    различные типы внутренних данных (целочисленные, с~плавающей запятой и~т.\,д.);
\item   обработчики прерываний и~исключений.
\end{itemize}

\subsubsection{Структура команды x86}
\includegraphics[width=1\linewidth,keepaspectratio,valign=t]{cmd_structure}

\subsubsection{Методы адресации}


\begin{enumerate}
\item \termin{Непосредственная} "--- константа
\item \termin{Прямая} (абсолютная) "--- переменная в~памяти по~фиксированному адресу (статическая)
\item \termin{Регистровая} "--- переменная в~регистре
\item \termin{Косвенно-регистровая (косвенная)} "--- указатель в~регистре
$$
\text{Адрес} = \Reg{Base} + 2^{Scale} \cdot \Reg{Index} + Disp
$$
$\Reg{Base}$ и~$\Reg{Index}$ "--- регистры, $Disp$ "--- смещение (константа)
\end{enumerate}




\subsubsection{Порядок следования байтов в~словах}


\begin{tabularx}{1\linewidth}{@{}LL@{}}
\termin{Прямой} (little-endian, Intel, VAX) & \termin{Обратный} (big-endian, Motorola) \\
младший байт слова 
по~младшему адресу
&
младший байт слова 
по~старшему адресу
\\[1ex]
% % \multicolumn{2}{K{0.9\linewidth}}{Число  FE 0A 91 87 в~двойном слове по адресу 0 будет выглядеть в~памяти как}
% \multicolumn{2}{c}{\termin{\texttt{FE 0A 91 87} по адресу~0:}}
% % \multicolumn{2}{c}{ff}
% \\
% \renewcommand{\arraystretch}{1}
% \begin{tabular}{@{}lr@{~}r@{~}r@{~}r@{}}
% &87&91&0A&FE\\
% № байта  &0      &1       &2      &3
% \end{tabular}
% &
% \renewcommand{\arraystretch}{1}
% \begin{tabular}{@{}lr@{~}r@{~}r@{~}r@{}}
% &FE&0A&91&87\\
% № байта  &0      &1       &2      &3
% \end{tabular}
% \multicolumn{2}{c}{\termin{\texttt{0A 0B 0C 0D} по адресу~0:}}
\multicolumn{2}{c}{\termin{\texttt{0x\,0A\,0B\,0C\,0D} по адресу~0:}}
% \multicolumn{2}{c}{ff}
\\
\renewcommand{\arraystretch}{1}
\begin{tabular}{@{}lr@{~}r@{~}r@{~}r@{}}
&0D&0C&0B&0A\\
№ байта  &0      &1       &2      &3
\end{tabular}
&
\renewcommand{\arraystretch}{1}
\begin{tabular}{@{}lr@{~}r@{~}r@{~}r@{}}
&0A&0B&0C&0D\\
№ байта  &0      &1       &2      &3
\end{tabular}
\end{tabularx}

\termin{Переключаемый} (bi-endian, bytesexual)

\termin{Смешанный} (middle-endian, mixed-endian) %"--- машинные слова от старшего к~младшему.
\begin{tabularx}{1\linewidth}{@{}LL@{}}
\renewcommand{\arraystretch}{1}
\begin{tabular}{@{}lr@{~}r@{~}r@{~}r@{}}
PDP-11&0B&0A&0D&0C\\
№ байта  &0      &1       &2      &3
\end{tabular}
&
\begin{tabular}{@{}lr@{~}r@{~}r@{~}r@{}}
&0C&0D&0A&0B\\
№ байта  &0      &1       &2      &3
\end{tabular}
\end{tabularx}





\subsection{Уровень операционной системы}
\epigraph{
\begin{stanza}
Гора Крукенберг\\
На реке Оккервиль;\\
Река Оккервиль\\
Под горой Крукенберг.\\
\end{stanza}
}{\Aquarium}

управление памятью, загрузка и~выполнение программ, системные вызовы, доступ к~устройствам
% Виртуальная память
% 
% Страничная организация памяти
% 
% % Реализация виртуальных команд ввода-вывода
% Файловая система
% 
% % Виртуальные команды для параллельной работы 
% Процессы

\begin{itemize}
\item    управление памятью (распределение между процессами, организация виртуальной памяти);
\item    загрузка программ в~оперативную память и~их~выполнение;
\item    исполнение запросов программ (системные вызовы);
\item    стандартизованный доступ к~периферийным устройствам (устройства ввода-вывода).
% \item    управление доступом к данным на энергонезависимых носителях (таких как жёсткий диск, оптические диски и др.), организованным в той или иной файловой системе.
% \item    обеспечение пользовательского интерфейса.
% \item    сохранение информации об ошибках системы.
\end{itemize}

\subsection{Уровень ассемблера}
\epigraph{
\begin{stanza}
Я~прочёл об этом в~старинных трактатах, \\
прочёл и~сразу ушел из деревни;\\
Скоро я~буду баснословно богатым \\
и~смогу претворить в~жизнь учения древних.\\
\end{stanza}
}{\Aquarium}

мнемоники, ассемблирование, ассемблеры

Разным процессорам соответствуют разные языки ассемблера.

Разные компиляторы также поддерживают разный синтаксис.

Мнемоники "--- символическое представление машинных команд.

 \lstinline!B9 CC CC CC CC! $\to$ \lstinline!movl $0xCCCCCCCC, %ecx!


Реализуется путем трансляции (ассемблирования), а~не интерпретации.


\resizebox{0.8\linewidth}{!}{
\tikzstyle{blockarrow}	= [-latex',thick,draw=blue]
\footnotesize
\begin{tikzpicture}[start chain=cpp going below,start chain=S going below,
every on chain/.style=join,every join/.style=blockarrow,
node distance=2ex and 4ex
]
\tikzstyle{block}	= [text width=16ex,text badly centered, minimum height=3ex, draw=black]
\tikzstyle{file}	= [block,  fill=yellow!40!white]
\tikzstyle{stage}	= [block, fill=blue,text=white]


\node[file,on chain=cpp] (prog1_s) {prog.s};
\node[stage,on chain=cpp] (cpp_asm) {Ассемблер};
\node[file,on chain=cpp] (prog1_o) {prog.o};
\node[stage,on chain=cpp] (linker) {Компоновщик};

  
\node[file, right= of linker,text width=20ex] (obj_lib) {Объектные файлы библиотек};
\path[blockarrow] (obj_lib) -- (linker);

\node[file,below= of linker] (prog) {prog};
\path[blockarrow] (linker) -- (prog);


\end{tikzpicture}
}

\begin{itemize}
\item \termin{GNU Assembler (GCC)} "--- более 45 платформ, большинство ОС, лицензия GNU GPL 3+ 
\item \termin{Flat Assembler (FASM)} "--- x86, DOS, MS Windows, UNIX-подобные (GNU/Linux, OpenBSD и др.), MenuetOS, KolibriOS, DexOS,  лицензия BSD 
\item \termin{NASM/Yasm} "--- x86, x86-64, GNU/Linux, DOS, MS Windows, UNIX,  лицензия BSD 
% \item HLASM "--- z/Architecture IBM
\item \termin{Turbo Assembler (TASM)/Lazy Assembler} "--- x86, DOS, MS~Windows
\item \termin{MASM} "--- x86, DOS, MS Windows

\end{itemize}

{} \termin{AT\&T}

\begin{lstlisting}[numbers=none]
movl $42, %eax

movl $0x10, %ebx


lea  -0x30(%rcx,%rax,8), %eax
movl (%ebx), %eax

movl $0xCCCCCCCC, %ecx


movl 0xCCCCCCCC, %ecx
\end{lstlisting}


% -4(%ebp), Intel:  [ebp - 4]
{} \termin{Intel}

\begin{lstlisting}[numbers=none]
mov eax, 42

mov ebx, 10h
mov ebx, 0x10 ; masm

lea eax, [rcx+rax*8-0x30]
mov eax, dword ptr [ebx]

mov ecx, 0xCCCCCCCC   
/*@\textcolor{red}{mov ecx, dword ptr [0xCCCCCCCC] ; masm}@*/
mov ecx, ds:[0xCCCCCCCC]
/*@\textcolor{red}{mov ecx, dword ptr [0xCCCCCCCC] ; nasm}@*/
\end{lstlisting}

\subsection{Языки высокого уровня}
\epigraph{
\begin{stanza}
Я~буду жить в~доме из костей земли \\
и~с~большой дороги будут заходить дети\\
Чтобы любоваться на мои кристаллы, \\
сияющие во фрактальном свете.\\
\end{stanza}
}{\Aquarium}

языки, компиляторы, GCC

\termin{Прикладное программирование}
% \bigskip

\begin{tabularx}{1\linewidth}{@{}Lp{0.4\linewidth}@{}}
Трансляция
\begin{itemize}
\item Фортран;
% \item Алгол;
\item C/Objective-C/C++;
\item Pascal/Object Pascal/Delphi.
\end{itemize}
&
Интерпретация
\begin{itemize}
\item sh/bash;
\item Python;
\item PHP.
\end{itemize}
\end{tabularx}
Уровень виртуальной машины  Java.
% \begin{itemize}
% \item Java.
% \end{itemize}

\termin{Сверхвысокоуровневые языки программирования}
\begin{itemize}
\item  Python;
\item Ruby;
\item AWK/Perl.
\end{itemize}


\subsubsection{Компиляторы C++ (x86)}

\begin{itemize}
\item \termin{GNU Compiler Collection (GCC)} "--- более 45 платформ, большинство ОС (порт под MS Windows "---  \termin{MinGW}), %7 языков (в~том числе C и~C++, стандарт), 
лицензия GNU GPL 3+ 
\item \termin{Portable C Compiler (PCC)} "--- Unix-подобные ОС, %GNU/Linux, 
MS Windows; лицензия BSD


\item \termin{TenDRA} "--- x86, x86-64, IA-64; POSIX-совместимые ОС; лицензия BSD

\item \termin{Oracle Solaris Studio} "--- x86, x86-64, SPARC; Solaris, OpenSolaris, GNU/Linux; собственническая лицензия

\item \termin{Intel C++ compiler} "--- x86, x86-64,  IA-64 (Itanium), GNU/Linux, MacOS X, MS Windows, коммерческая собственническая лицензия

\item \termin{Open Watcom} "--- DOS, OS/2 и MS Windows; лицензия  	
Sybase Open Watcom Public License version 1.0, 
%не полностью поддерживает стандарт С++
неполная поддержка стандарта

\item \termin{MS Visual C++} "--- x86, x86-64, IA-64 и~.NET, только MS Windows, коммерческая собственническая лицензия, %грубые 
нарушения стандарта

% \item \termin{Norcroft C Сompiler} "--- Intel Pentium для GNU/Linux, коммерческая собственническая лицензия
% 
% 
% \hrulefill
% \item \termin{Clang} "--- виртуальная RISC-машина LLVM

\end{itemize}

Коллекция GCC:

\termin{gcc} "---  компилятор~C;

\termin{g++} "---  компилятор~C++.

\subsubsection{Компиляция}

main.cpp
\begin{lstlisting}
int x = 13;
int main()
{
    int y = 2*x + 123;
...
}
\end{lstlisting}

g++ -S main.cpp $\to$

main.s
\begin{lstlisting}
...
.globl	x
	.data
	.align 4
	.type	x, @object
	.size	x, 4
x:
	.long	13
...
	movl	x, %eax
	addl	%eax, %eax
	addl	$123, %eax
	movl	%eax, -12(%ebp)
\end{lstlisting}




\section{История} 
\epigraph{\begin{stanza}[0mm]Действительность "--- не бред собачий.\\
Она сложнее и~богаче.\end{stanza}}
{Валентин Берестов}

Современные ВС: 6 уровней; как отрастали эти шесть уровней, начиная от одноуровневых счётов и~одно?двух?уровневого жаккардова станка

\subsection{Развитие вычислительной техники}

1938 "--- механическая счётная машина Z1 Конрада Цузе, Германия, была использована уже двоичная система счисления.
Для ввода-вывода данные преобразовывались в~десятичный вид.

1939 "--- усовершенствованный вариант вычислителя Цузе, Z2 на основе телеграфных реле.

1941 "--- Z3

% http://wiki.livid.pp.ru/students/cs/lectures/1.html
% В~механической счётной машине Z1 Конрада Цузе (1938 г.) была использована уже двоичная система счисления.
% Это позволило существенно уменьшить размеры устройства.
% Усовершенствованный вариант вычислителя Цузе, Z2 на основе телеграфных реле (1939),  закрепил использование двоичной логики.



1943 "--- ЭНИАК (ENIAC, Electronic Numerical Integrator and Computer) на  вакуумных лампах и десятичной СС
% 
% Реле может находиться только в~двух состояниях "--- оно открыто либо закрыто.
% Именно в~электромеханическом реле в~Mark II (1946), согласно легенде, был обнаружен первый баг.

1943--1950 "--- Z4 на реле, первый ЯВУ



\colorlet{csArch}{orange!70!black}
\newcommand{\terminModel}[1]{{\textcolor{csArch}{#1}}}
\newcommand{\terminComment}[1]{{\textcolor{gray}{#1}}}

\subsection{Поколения процессоров Intel}

\begin{tabularx}{1\linewidth}{@{}l@{~}L@{}}

\termin{4-битные:}& 4004, 4040\\

\termin{8-битные:}& 8008, 8080 \terminComment{(адрес "--- %16 или 
14),} 8085 \terminComment{(частота "--- 5 МГц)}\\

\termin{16-битные:}& \termin{8086} \terminComment{(адрес "--- 20, \termin{слово "--- 16 бит}, %отдельный 
FPU 8087),} 8088 \rlap{\terminComment{(8 бит),}}\\
&80186, 80188,\\
&80286 \terminComment{(адрес "--- 24)}\\
\termin{32-битные:}& \textcolor{colorRegister}{
iAPX 432 %, 80960, 80860, 
"--- не x86-совместим
}
\\
&80386DX, 80386SX\\
&80486DX \terminComment{(встроенный FPU),} 80486SX\\
\end{tabularx}

\begin{tabularx}{1\linewidth}{@{}l@{}L@{}}
&Pentium (P5, P54, P54C, \terminComment{данные "--- 64}), Pentium MMX\\
&Pentium Pro, Pentium II \terminModel{(Klamath, Deschutes)}, Celeron \terminModel{(Covington, Mendocino)},\\
&Pentium III (SSE, \terminModel{Katmai, Coppermine, Tualatin}), Celeron \terminModel{(Coppermine, Tualatin)}...\\
\end{tabularx}
\\
\includegraphics[width=1\linewidth,keepaspectratio,valign=t]{IntelProcessorRoadmap}








\subsection{Связь уровней}


\epigraph{
Вертикальная структура древа больше связана с~космологией, а~горизонтальная "--- с~магическими ритуалами. Чаще всего древо изображалось с~восемью ветвями, по четыре с~каждой стороны. Имело оно и~четыре главных цвета: красный, черный, белый, синий.}{Г.\,Белякова}

в~том числе компиляция и~интерпретация

% \nsection{Контрольные вопросы}
% 
% \begin{enumerate}
% % \item Какова цель курса?
% 
% \item Что включает архитектура системы?
% \item Что такое вычислительная система?
% 
% \item Какие вы знаете единицы измерения информации?
% 
% 
% % \item Какие способы представления знаковых чисел используются в~ЭВМ?
% % \item Какие логические и~битовые операции вы~знаете?
% 
% \item Какие вы знаете компоненты ЭВМ?
% 
% 
% \item Чем отличаются фон-Неймановская и~гарвардская архитектуры?
% 
% \item Из чего состоит системная шина (магистраль)?
% 
% \item Какие вы знаете основные виды регистров \rlap{x86?}
% 
% \item Как используется регистр ip?
% 
% \item Как используется регистр sp?
% \end{enumerate}

\printquestions