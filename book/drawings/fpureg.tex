% \scriptsize
\tikzstyle{blockarrow}	= [-latex',draw]
% % \footnotesize
\schemafont
\scriptsize

\newcommand{\regBelow}[5][]
{
  \tikzmath{int \hibit; \hibit=#4 - 1;}
  \node[reg, minimum width=#4ex, below = 4ex of #5.south east, anchor = north east] (#2)  {};
  \node%[anchor = west] at (sw-|sign.west) 
  [left = of #2, text badly ragged, #1] {#3};
  \node[bitlabel, below =  of #2.south west, anchor = north west]   {$\hibit$};
  \node[bitlabel, below =  of #2.south east, anchor = north east]   {$0$};
}

\begin{tikzpicture}[
start chain=Mem going below,
% every on chain/.style=join,
% every on chain/.style=solidchaincell,
% every join/.style=blockarrow,
node distance=0ex,
baseline=(current bounding box.north)
]
% \tikzstyle{block}	= [text width=10ex,text badly centered, minimum height=4ex, draw=black]
\tikzstyle{block}	= [text badly centered, minimum height=2ex, draw=black]

\tikzstyle{reg}	= [block,  fill=clRegisterLight]
\tikzstyle{bit}	= [reg, minimum width=2ex]

% \tikzstyle{reglabel}	= [block,  draw=none, node distance=0ex and 8ex, text=clRegisterDark]
\tikzstyle{bitlabel}	= [scale=0.7]

\foreach \i in {0,...,7}
{
  \tikzmath{int \di; \di=2*\i;}
  \node[reg, solidchaincell, minimum width=64ex, on chain=Mem]  (mant\i) {};
  \node[reg, solidchaincell, minimum width=15ex, left = of mant\i]  (exp\i) {};
  \node[bit, solidchaincell, left = of exp\i]  (sign\i) {};
  \node[left = of sign\i]  (r\i) {$r_\i$};

  \node[bit, right = 1ex of mant\i]  (tag1\i) {};
  \node[bit, solidchaincell, right = of tag1\i]  (tag0\i) {};
  \node[bitlabel, right =  of tag0\i]   {$\di$};
  
}
% \node[above =  of sign0]  (sign) {Знак};
\node[above =  of exp0]  (exp) {Порядок};
% \node at (sign-|exp0)  {Порядок};
% \node[above =  of mant0]   {Мантисса};

\node[anchor=base] at (exp.base-|sign0) (sign) {Знак};
\node at (exp-|mant0)  {Мантисса};

\node[bitlabel, below =  of sign7]   {$79$};
\node[bitlabel, below =  of exp7.south west, anchor = north west]   {$78$};
\node[bitlabel, below =  of exp7.south east, anchor = north east]   {$64$};
\node[bitlabel, below =  of mant7.south west, anchor = north west]   {$63$};
\node[bitlabel, below =  of mant7.south east, anchor = north east]   {$0$};

\node[above =  of sign.north west, anchor = south west] {Регистры данных $r_0-r_7$};

\node[above =  of tag00.north west, text width = 13ex, text badly centered] {Слово тегов $tw$};
\node[bitlabel, below =  of tag17]   {$15$};

% \node[reg, minimum width=16ex, below = 4ex of mant7.south east, anchor = north east] (sw)  {};
% \node%[anchor = west] at (sw-|sign.west) 
% [left = of sw] {Слово состояния $sw$};
% \node[bitlabel, below =  of sw.south west, anchor = north west]   {$15$};
% \node[bitlabel, below =  of sw.south east, anchor = north east]   {$0$};
\regBelow{sw}{Слово состояния $sw$}{16}{mant7}

% \node[reg, minimum width=16ex, below = 4ex of sw.south east, anchor = north east] (cw)  {};
% \node%[anchor = west] at (cw-|sign.west)  
% [left = of cw] {Управляющее слово $cw$};
% \node[bitlabel, below =  of cw.south west, anchor = north west]   {$15$};
% \node[bitlabel, below =  of cw.south east, anchor = north east]   {$0$};
\regBelow{cw}{Управляющее слово $cw$}{16}{sw}

\regBelow[text width = 32ex]{fip}{Указатель на последнюю команду $fip$}{48}{cw}
\regBelow[text width = 32ex]{fdp}{Указатель на последний операнд $fdp$}{48}{fip}

\regBelow{opcode}{Код операции $fop$}{10}{fdp}

\end{tikzpicture}
