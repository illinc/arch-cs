\newcommand{\push}[3][]
{
  \tikzmath{\idec = \i-1;}
%   \expandafter\xintifboolexpr{\sp > \arabic{stackpointer}}
  \xintifboolexpr{\sp > \idec}
    {\node[mem,solidchaincell,on chain=Mem, #1] (s\i) {#3}}
    {\tikzstyle{mem}	= [block] \node[mem,solidchaincell,on chain=Mem, #1] (s\i) {#2}}
  ;  

%   \xintifboolexpr{\sp > #2}
%     {\tikzstyle{mem}	= [block,  fill=clMemoryLight]}
%     {\tikzstyle{mem}	= [block]}
%   ;
%   \xintifboolexpr{\sp < #2}
%     {\tikzstyle{mem}	= [block]}
%     {}
%   ;
  
  %   \stepcounter{stackpointer}
  \tikzmath{\i = \i+1;}
}


\tikzstyle{blockarrow}	= [-latex',draw]
% \footnotesize
\scriptsize
% \tiny
\begin{tikzpicture}[
start chain=Mem going below,
% every on chain/.style=join,
% every on chain/.style=solidchaincell,
% every join/.style=blockarrow,
%	 	y and x
node distance=2ex and 2ex,
baseline=(current bounding box.north),
x = 36ex
]
\tikzstyle{block}	= [text width=20ex,text badly centered, minimum height=4ex, draw=black]

\tikzstyle{reg}	= [block,  fill=clRegisterLight, text width=5ex,]
\tikzstyle{mem}	= [block,  fill=clMemoryLight]
\tikzstyle{bigmem}	= [mem, minimum height=8ex ]


% \newcounter{figletter}
\setcounter{figletter}{1}

% \newcounter{stackpointer}
% \setcounter{stackpointer}{0}


\foreach \sp in {1, 4, 4, 1}
{
  \coordinate (sbottom) at (\arabic{figletter}, 0);
  \node[mem,solidchaincell, on chain=Mem, below=of sbottom] (s0) {$\ldots$};
  % \node[mem,solidchaincell,on chain=Mem]  {};
  
  \tikzmath{int \i, \idec; \i = 1;}

  \push{}{Адрес возврата} // s1
  \push{}{$var_1$}
  \push{}{$\ldots$}
  \push{}{$var_n$}
  \push{$\ldots$}{$\ldots$}

  \xintifboolexpr{\sp > 3}
    { \draw [decorate,decoration={brace,amplitude=10pt},xshift=-4pt,yshift=0pt]
(s4.south west) -- (s2.north west)
node [black,midway,xshift=-6ex] {$size$} }
    {}
  ; 

 
  
%   \tikzstyle{mem}	= [block]
%   \node[mem,solidchaincell,on chain=Mem]  {};
%   \node[mem,solidchaincell,on chain=Mem]  {$\ldots$};
\tikzstyle{mem}	= [block,  fill=clMemoryLight]
  \node[mem,solidchaincell,on chain=Mem, label=left:$f:$] (c1) {$sp = sp - size$};
  \node[mem,solidchaincell,on chain=Mem] (c2) {$\ldots$};
  \node[mem,solidchaincell,on chain=Mem] (c3) {$sp = sp + size$};
  \node[mem,solidchaincell,on chain=Mem] (c4)  {$ret$};
 
  \node[reg, right= of s\sp]  (sp) {$sp$};
  \path[blockarrow] (sp) -- (s\sp);  
  

% %   \node[reg, right= of s\sp]  (bp) {$bp$};
% %   \path[blockarrow] (bp) -- (s\sp);  
  
  \node[reg, right= of c\arabic{figletter}]  (ip) {$ip$};
  \path[blockarrow] (ip) -- (c\arabic{figletter});  

  \node[on chain=Mem]   {\normalfont\normalsize\small\asbuk{figletter})\stepcounter{figletter}};
}

\end{tikzpicture}