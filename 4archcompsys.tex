\title{Архитектура вычислительных систем}

\newcommand\Att{AT\&T}

\newcommand\EAX{\lstinline!EAX!}
\newcommand\EBX{\lstinline!EBX!}
\newcommand\ECX{\lstinline!ECX!}
\newcommand\EDX{\lstinline!EDX!}


\newcommand\ESP{\lstinline!ESP!}

\newcommand\ESI{\lstinline!ESI!}

\nmsNewName{\Competencia}{\termin{ОПК-2.2}	Знание и~понимание архитектуры и~принципов построения вычислительных систем}


\def\Byte(#1,#2,#3,#4,#5,#6,#7,#8){
\node [rectangle split,rectangle split parts=8, rectangle split horizontal,draw ] at (2,2)
{\nodepart{one}#1\nodepart{two}#2\nodepart{three}#3\nodepart{four}#4\nodepart{five}#5\nodepart{six}#6\nodepart{seven}#7\nodepart{eight}#8};
}

\newcommand\mathlst[1]{\text{\lstinline!#1!}}

\lstset{language=C++}


%% far from complete list of gasm-specific keywords and instructions in AT&T syntax
% \lstdefinelanguage[x86gas]{Assembler}[x86masm]{Assembler}{%
%     ,morekeywords={rax,rbx,rcx,rdx,rip,rdi,rsi,rsp,subq,decl,movq,movl,xorl,imull,popq}%
%     ,morekeywords=[2]{.file,.section,.string,.text,.globl,.cfi_startproc,.cfi_def_cfa_offset,.cfi_endproc,.size,.ident}%
%     ,morecomment=[s][\color{olive}]{\%}{x}%
%     ,morecomment=[s][\color{olive}]{\%}{l}%
%     ,morecomment=[s][\color{olive}]{\%}{h}%
% %     ,morecomment=[s][\color{olive}]{\%}{ }%
%     ,morecomment=[s][\color{olive}]{\%}{,}%
%     ,morecomment=[s][\color{olive}]{\%}{)}%
% %     ,morecomment=[l][\color{olive}]{\%}%
% }

\lstdefinelanguage[x86gas]{Assembler}
{%
 keywords=[1]{\%, \$},
 keywordstyle=[1]\color{olive}
    ,morekeywords=[2]{.file,.section,.string,.text,.globl,.cfi_startproc,.cfi_def_cfa_offset,.cfi_endproc,.size,.ident}%
    ,morekeywords={subr,divr}%
%     ,morekeywords={mov,movq,movl,xorl,imull,popq}%
%     ,morecomment=[s][\color{olive}]{\%}{x}%
%     ,morecomment=[s][\color{olive}]{\%}{l}%
%     ,morecomment=[s][\color{olive}]{\%}{h}%
%     ,morecomment=[s][\color{olive}]{\%}{i}%
%     ,morecomment=[s][\color{olive}]{\%}{p}%
%     ,morecomment=[s][\color{olive}]{\%}{s}%
}




\lstnewenvironment{ccol}[1][]{\lstset{language=c,#1}}{}
\lstnewenvironment{acol}[1][]{\lstset{language=[x86gas]Assembler,#1}}{}

\lstset{language=[x86gas]Assembler}
\lstset{language=C++, alsolanguage=[x86masm]Assembler}
% \lstset{language=C++, alsolanguage=[x86gas]Assembler}




\definecolor{blue(ncs)}{rgb}{0.0, 0.53, 0.74}
\colorlet{colorRegister}{olive}
\colorlet{colorMemory}{blue(ncs)}

\colorlet{colorRegisterLight}{colorRegister!40!white}
\colorlet{colorMemoryLight}{colorMemory!20!white}
\colorlet{colorCalcLight}{yellow!40!white}

\newcommand{\Reg}[1]{{\textcolor{colorRegister}{#1}}}

\newcommand{\mathReg}[1]{\text{\Reg{\texttt{#1}}}}

\definecolor{codestronghighlight}{RGB}{255, 255,120}
\definecolor{codehighlight}{RGB}{180, 255,180}

% http://latexcolor.com/
\definecolor{calpolypomonagreen}{rgb}{0.12, 0.3, 0.17}
\definecolor{cadetblue}{rgb}{0.37, 0.62, 0.63}
\definecolor{ferngreen}{rgb}{0.31, 0.47, 0.26}
\definecolor{glaucous}{rgb}{0.38, 0.51, 0.71}	
\definecolor{intelblue}{HTML}{0071c5}

\colorlet{colorIntel}{intelblue}
\colorlet{colorGas}{magenta}


\newcommand{\onlyIntel}[1]{{\color{colorIntel}{Intel: #1}}}

\newcommand{\onlyGas}[1]{{\color{colorGas}{GAS: #1}}}

\newcommand{\RN}[1]{\ensuremath{\mathrm{#1}}}
\newcounter{romannumberx}
\def\ToRomanEmpire#1{\setcounter{romannumberx}{#1}\Roman{romannumberx}}




% \DeclareMathOperator{\And}{and}
\DeclareMathOperator{\Or}{or}
\DeclareMathOperator{\Xor}{xor}
\DeclareMathOperator{\Not}{not}
\DeclareMathOperator{\Neg}{neg}



% Рисование регистров

\tikzmath{real \bitwidthex, \halfbitex; 
  \bitwidthex=6; 
  \halfbitex = \bitwidthex/2;}
  
\tikzstyle{bitlabel}	= []
\tikzstyle{block}	= [text badly centered, minimum height=\bitwidthex ex, draw=black]
\tikzstyle{reg}	= [block,  fill=colorRegisterLight]
\tikzstyle{bit}	= [reg, solidchaincell, minimum width=\bitwidthex ex]

\newcommand{\onebit}[3][]
{
  \node[bit, on chain, label=below:$#2$, #1] (#2) {$#3$};
}

\newcommand{\bitfield}[4][]
{
  \tikzmath{int \bits, \wdex; \bits = #3 - #2 + 1;
    \wdex = \bits * \bitwidthex;}
  \node[bit, minimum width= \wdex ex, on chain, #1] (#2)  {$#4$};
  \coordinate[right = \halfbitex ex of #2.south west, label=below:$#3$] (be#3);
  \coordinate[left = \halfbitex ex of #2.south east, label=below:$#2$] (bs#2);
}

\newcommand{\regfloat}[4][]
{
\begin{tikzpicture}[
baseline=(mant0.base)
]
  \tikzmath{  \bitwidthex=4; }
  \node[reg, solidchaincell, minimum width=32ex, #1]  (mant0) {$#4$};
  \node[reg, solidchaincell, minimum width=10ex, left = of mant0, #1]  (exp0) {$#3$};
  \node[bit, solidchaincell, left = of exp0, #1]  (sign0) {$#2$};
\tikzstyle{bitlabel}	= [scale=0.7]  
\node[above = 0ex of exp0, bitlabel]  (exp) {Порядок};
\node[anchor=base, bitlabel] at (exp.base-|sign0) (sign) {Знак};
\node[bitlabel] at (exp-|mant0)  {Мантисса};  
\end{tikzpicture}
}

